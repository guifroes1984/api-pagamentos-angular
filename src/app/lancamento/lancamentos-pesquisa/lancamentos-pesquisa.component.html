<div class="min-vh-100 bg-light pt-5">
  <div class="container-fluid py-4">
    <div class="row justify-content-center">
      <div class="col-12 col-xl-10">
        <div class="card shadow-lg border-0 rounded-3">
          <div class="card-header bg-primary text-white py-3 rounded-top">
            <div class="row align-items-center">
              <div class="col">
                <h1 class="h3 mb-0 fw-bold">
                  <i class="bi bi-search me-2"></i>
                  Pesquisa de Lançamentos
                </h1>
              </div>
              <div class="col-auto">
                <span class="badge bg-light text-primary fs-6">
                  {{ totalRegistros }} registros
                </span>
              </div>
            </div>
          </div>

          <div class="card-body p-4">
            <div class="row g-3 mb-4">
              <div class="col-12 col-md-4">
                <label class="form-label fw-semibold">Descrição</label>
                <input type="text" class="form-control" #descricaoInput [value]="filtro.descricao || ''"
                  (input)="filtro.descricao = descricaoInput.value" (keydown.enter)="pesquisar()"
                  placeholder="Digite para pesquisar...">
              </div>

              <div class="col-12 col-md-4">
                <label class="form-label fw-semibold">Vencimento</label>
                <div class="row g-2">
                  <div class="col-6">
                    <input type="date" class="form-control" #dataInicioInput
                      [value]="formatarDataParaInput(filtro.dataVencimentoInicio)"
                      (change)="onDataInicioChange(dataInicioInput.value)" (keydown)="bloquearDigitacao($event)">
                  </div>
                  <div class="col-6">
                    <input type="date" class="form-control" #dataFimInput
                      [value]="formatarDataParaInput(filtro.dataVencimentoFim)"
                      (change)="onDataFimChange(dataFimInput.value)" (keydown)="bloquearDigitacao($event)"
                      placeholder="até">
                  </div>
                </div>
              </div>

              <div class="col-12 col-md-4 d-flex align-items-end gap-2">
                <button type="button" class="btn btn-primary flex-fill" (click)="pesquisar()">
                  <i class="bi bi-search me-1"></i>
                  Pesquisar
                </button>
                <button type="button" class="btn btn-outline-danger" (click)="limpar()">
                  <i class="bi bi-x-circle me-1"></i>
                  Limpar
                </button>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-hover table-striped table-bordered mb-4">
                <thead class="table-light">
                  <tr>
                    <th scope="col" class="w-25">Pessoa</th>
                    <th scope="col" class="w-30">Descrição</th>
                    <th scope="col" class="w-15 text-center">Vencimento</th>
                    <th scope="col" class="w-15 text-center">Pagamento</th>
                    <th scope="col" class="w-10 text-center">Valor</th>
                    <th scope="col" class="w-5 text-center">Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let lanc of fonteDados.data">
                    <td class="fw-semibold">{{ lanc.pessoa.nome }}</td>
                    <td>{{ lanc.descricao }}</td>
                    <td class="text-center">{{ lanc.dataVencimento | date: 'dd/MM/yyyy' }}</td>
                    <td class="text-center">
                      {{ lanc.dataPagamento ? (lanc.dataPagamento | date:'dd/MM/yyyy') : '-' }}
                    </td>
                    <td class="text-end">
                      <span [class]="lanc.tipo === 'DESPESA' ? 'text-danger' : 'text-success'">
                        {{ lanc.valor | currency:'BRL':'symbol':'1.2-2' }}
                      </span>
                    </td>
                    <td class="text-center">
                      <div class="d-flex gap-2 justify-content-center">
                        <button type="button" class="btn btn-outline-primary btn-sm"
                          [routerLink]="['/lancamentos', lanc.codigo]" title="Editar">
                          <i class="bi bi-pencil"></i>
                        </button>
                        <button type="button" class="btn btn-outline-danger btn-sm" (click)="excluir(lanc.codigo)"
                          title="Excluir">
                          <i class="bi bi-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr *ngIf="fonteDados.data.length === 0">
                    <td colspan="6" class="text-center py-4">
                      <div class="text-muted">
                        <i class="bi bi-inbox display-4 d-block mb-2"></i>
                        <h5>Nenhum resultado encontrado</h5>
                        <p class="mb-0">Tente ajustar os filtros de pesquisa</p>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="row align-items-center mt-3" *ngIf="habilitarPaginacao()">

              <div class="col-md-6">
                <span class="text-muted small">
                  Mostrando
                  {{ Math.min((paginaAtual + 1) * itensPorPagina, totalRegistros) }}
                  de {{ totalRegistros }} registros
                </span>
              </div>

              <div class="col-md-6">
                <div class="d-flex justify-content-end align-items-center gap-2">

                  <select class="form-select form-select-sm w-auto" #itensPorPaginaSelect [value]="itensPorPagina"
                    (change)="mudarItensPorPagina(itensPorPaginaSelect.value)">
                    <option value="5">5 por página</option>
                    <option value="10">10 por página</option>
                    <option value="15">15 por página</option>
                  </select>

                  <nav>
                    <ul class="pagination pagination-sm mb-0">

                      <li class="page-item" [class.disabled]="paginaAtual === 0">
                        <button class="page-link" (click)="irParaPagina(0)">
                          <i class="bi bi-chevron-double-left"></i>
                        </button>
                      </li>

                      <li class="page-item" [class.disabled]="paginaAtual === 0">
                        <button class="page-link" (click)="irParaPagina(paginaAtual - 1)">
                          <i class="bi bi-chevron-left"></i>
                        </button>
                      </li>

                      <li class="page-item disabled">
                        <span class="page-link">
                          Página {{ paginaAtual + 1 }} de {{ totalPaginas }}
                        </span>
                      </li>

                      <li class="page-item" [class.disabled]="paginaAtual >= totalPaginas - 1">
                        <button class="page-link" (click)="irParaPagina(paginaAtual + 1)">
                          <i class="bi bi-chevron-right"></i>
                        </button>
                      </li>

                      <li class="page-item" [class.disabled]="paginaAtual >= totalPaginas - 1">
                        <button class="page-link" (click)="irParaPagina(totalPaginas - 1)">
                          <i class="bi bi-chevron-double-right"></i>
                        </button>
                      </li>

                    </ul>
                  </nav>
                </div>
              </div>
            </div>

            <div class="row mt-4">
              <div class="col-12">
                <button *ngIf="auth.temPermissao('ROLE_CADASTRAR_LANCAMENTO')" class="btn btn-primary"
                  routerLink="/lancamentos/novo">
                  <i class="bi bi-plus-circle me-1"></i>
                  Novo Lançamento
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>